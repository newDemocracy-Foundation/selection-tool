<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="utf-8">

	<title>Stratified Random Selection Tool</title>

	<!-- CSS -->
	<link href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,300;0,400;0,500;0,700;1,300;1,400;1,500;1,700&display=swap" rel="stylesheet">
	<link rel="stylesheet" type="text/css" href="css/main.css"/>

	<!-- JavaScript -->
	<script type="text/javascript" src="js/xlsx.core.min.js"></script>
	<script type="text/javascript" src="js/math.min.js"></script>
	<script src="https://unpkg.com/javascript-lp-solver/prod/solver.js"></script>

	<!-- Favicon -->
	<link rel="icon" href="favicon.ico"  type="image/ico">

</head>

<body>

	<header>
		<div class="title">Stratified Random Selection Tool</div>
		<div class="logo"><a href="https://www.newdemocracy.com.au/"><img src="img/logo.png" /></a></div>
	</header>

	<main>
		
		<nav class="top">
			<div class="tab active" data-pane="about">About</div>
			<div class="tab" data-pane="import">Import data</div>
			<div class="tab" data-pane="settings">Choose settings</div>
			<div class="tab" data-pane="run">Run selection</div>
			<div class="tab" data-pane="export">Export selection</div>
		</nav>

		<div id="progress" class="progress" style="width: 20%;"></div>

		<div class="pane" data-pane="about">
			
			<div class="text-wrap">

				<p>Emerging models of public deliberation&mdash;such as <a class="intext" target="_blank" rel="noopener noreferrer" href="https://newdemocracy.com.au/wp-content/uploads/2017/05/docs_researchnotes_2017_May_nDF_RN_20170508_FormsOfMiniPublics.pdf">citizens' juries, citizens' assemblies or deliberative polls</a>&mdash;require that the participants be randomly selected. Usually it is desirable for the random selection to be <em>stratified</em>: that is, to be representative of the general population along dimensions such as age, gender, nationality or socio-economic status.</p>

				<p>This tool makes it easier to perform such stratified random selection.</p>

				<h2>Who is providing this tool?</h2>

				<p>This tool is made available by the <a class="intext" target="_blank" rel="noopener noreferrer" href="https://www.newdemocracy.com.au/">newDemocracy Foundation</a>, an independent, non-partisan research and development organisation. We aim to discover, develop, demonstrate, and promote complementary alternatives which will restore trust in public decision making.</p>

				<h2>Why should I trust it?</h2>

				<p>To maintain the integrity of a mini-public, it is important when selecting participants</p>

				<ol style="list-style-type: lower-alpha;">
					<li>that the selection is genuinely random, and</li>
					<li>that personal information about the candidates is kept private.</li>
				</ol>

				<p>To this end, this selection tool has the following features.</p>

				<dl>
					<dt>Open source</dt>
					<dd>
						<p>The source code for this tool is publicly available and can be found in <a href="https://github.com/newDemocracy-Foundation/selection-tool" target="_blank" rel="noopener noreferrer" class="intext">this GitHub repository</a>.</p>
						<p>To ensure you are using the code that is in the GitHub repository, you can access this page via the following direct link on the GitHub Pages domain.</p>
						<pre>https://newDemocracy-Foundation.github.io/selection-tool/</pre>
					</dd>

					<dt>Runs locally</dt>
					<dd>
						<p>The selection algorithm will run locally in your browser. The tool will work even if you disconnect from the internet (after initially loading the tool).</p>
						<p>The tool does not upload any data (including data that you input, such as candidate information) to the internet.</p>
						<p>If you are using any browser extensions, it is possible that you have previously granted them permission to access the data on pages that you visit, including this tool. If privacy is a concern, we suggest you temporarily disable your browser extensions whilst performing the selection to ensure they do not have access to candidate information.</p>
					</dd>
					
				</dl>

				<h2>What do I need?</h2>

				To use the tool, you need two sets of information.

				<ul>
					<li>A spreadsheet containing demographic information for each of the eligible candidates. To understand the required formatting, please refer to this example <a class="intext" href="data/example-people-simple.xlsx">Excel spreadsheet</a>, or this <a class="intext" href="/data/example-people-simple.csv">CSV file</a>.<br /><br /></li>
					<li>A spreadsheet containing information about the distribution of demographic factors in the population for which you want your random sample to be representative. To understand the required formatting, please refer to this example <a class="intext" href="data/example-categories-simple.xlsx">Excel spreadsheet</a>, or this <a class="intext" href="/data/example-categories-simple.csv">CSV file</a>.</li>
				</ul>

				<h2>Getting Help</h2>

				<p>If you need help using the tool or understanding if it is right for your situation, please contact Kyle Redman at <a class="intext" href="mailto:kyle.redman@newdemocracy.com.au ">kyle.redman@newdemocracy.com.au</a>.</p>

				<p>If you have any technical questions, bug reports, or suggested improvements, please <a href="https://github.com/newDemocracy-Foundation/selection-tool/issues" target="_blank" rel="noopener noreferrer" class="intext">open an issue</a> in the <a href="https://github.com/newDemocracy-Foundation/selection-tool" target="_blank" rel="noopener noreferrer" class="intext">GitHub repository</a>.</p>

				<h2>One final note</h2>

				<p>Be aware that depending on the particular makeup of your pool of candidates, and the specifications of the stratified sample you are trying to obtain, it is possible that the tool may not be able to find a valid sample. If this occurs, the tool will inform you.</p>

				<div class="acknowledgements">
					
					<p>This tool makes use of the following JavaScript libraries: <a href="https://github.com/JWally/jsLPSolver" target="_blank" rel="noopener noreferrer" class="intext">jsLPsolver</a>, <a href="https://github.com/SheetJS/sheetjs" target="_blank" rel="noopener noreferrer" class="intext">SheetJS</a> and <a href="https://mathjs.org/" target="_blank" rel="noopener noreferrer" class="intext">mathjs</a>. The code is modelled on a similar <a href="https://github.com/sortitionfoundation/stratification-app" target="_blank" rel="noopener noreferrer" class="intext">Python-based selection tool</a> developed by the <a href="https://www.sortitionfoundation.org/" target="_blank" rel="noopener noreferrer" class="intext">Sortition Foundation</a>.</p>

				</div>



			</div>

			<nav class="bottom">
				<div class="tab inactive"></div>
				<div class="tab" data-pane="import"></div>
			</nav>

		</div>

		<div class="pane hide" data-pane="import">

			<div class="two-column">

				<div>
					<h3>Import your <strong>candidate information</strong></h3>
					<div id="dragdrop-people" class="filedrop">
						<span class="msg-nofile">Drag and drop a CSV or Excel file here.</span>
						<span class="msg-file"><span id="filename-people" class="filename"></span><button id="remove-people" class="remove-button">Click to remove &#215;</button></span>
						<input id="browse-people" type="file" class="filebrowse" />
					</div>
				</div>

				<div>
					<h3>Import your <strong>population profile</strong></h3>
					<div id="dragdrop-variables" class="filedrop">
						<span class="msg-nofile">Drag and drop a CSV or Excel file here.</span>
						<span class="msg-file"><span id="filename-variables" class="filename"></span><button id="remove-variables" class="remove-button">Click to remove &#215;</button></span>
						<input id="browse-variables" type="file" class="filebrowse" />
					</div>
				</div>

			</div>

			<ul>
				<li><a href="#" id="loadExampleData" class="intext">Load example data</a>.</li>
				<li>Download example candidate information as <a class="intext" href="data/example-people-simple.csv">CSV</a>, <a class="intext" href="data/example-people-simple.xlsx">Excel</a>.</li>
				<li>Download example population profile as <a class="intext" href="data/example-categories-simple.csv">CSV</a>, <a class="intext" href="data/example-categories-simple.xlsx">Excel</a>.</li>
				<li>TODO - provide structured help to create the population profile file.</li>
			</ul>

			<nav class="bottom">
				<div class="tab" data-pane="about"></div>
				<div class="tab" data-pane="settings"></div>
			</nav>

		</div>

		<div class="pane hide" data-pane="settings">

			Selection algorithm: <select name="algorithm" id="algorithm-select">
			</select>

			<br /><br />

			Check same address? <input type="checkbox" name="check-same-address" id="checkSameAddress" checked />

			<br /><br />

			Fair to households? <input type="checkbox" name="fair-to-housholds" id="fairToHouseholds" />

			<br /><br />

			Number of people to select: <input type="number" name="n-to-select" id="n-to-select" value="11"/>

			<br /><br />

			<ul>
				<li>Explain different selection algorithms (broadly how they work, strengths / weaknesses, links to literature).</li>
				<li>Explain other settings do.</li>
				<li>Add new settings to make more flexible (eg. specify sameAddressCols, etc.)</li>
			</ul>

			<nav class="bottom">
				<div class="tab" data-pane="import"></div>
				<div class="tab" data-pane="run"></div>
			</nav>

		</div>

		<div class="pane hide" data-pane="run">

			<div id="run" class="button run-button">Run Selection</div>

			<div id="log" class="log">

			</div>

			<ul>
				<li>Log messages while in progress, rather than all at the end (https://stackoverflow.com/questions/13537096/can-i-force-the-browser-to-render-out-the-dom-changes-before-continuing-javascri)</li>
			</ul>

			<nav class="bottom">
				<div class="tab" data-pane="settings"></div>
				<div class="tab" data-pane="export"></div>
			</nav>

		</div>

		<div class="pane hide" data-pane="export">

			<ul>
				<li>Use the buttons below to export the random selection in your desired format.</li>
				<li>TODO - show summary statistics for selection.</li>
				<li>TODO - add functionality to export people who were NOT selected.</li>
			</ul>

			<div id="export-csv" class="button">Export as .CSV</div> <div id="export-xlsx" class="button">Export as .XLSX</div>

			<nav class="bottom">
				<div class="tab" data-pane="run"></div>
				<div class="tab inactive"></div>
			</nav>

		</div>

	</main>

	<footer>
		<div>
			<a href="https://www.newdemocracy.com.au/">newDemocracy Foundation</a>
			<br />
			Made available under an MIT License (?).
		</div>
		<div class="right">
			Built and maintained by <a href="https://lukethorburn.com/">Luke Thorburn</a>
		</div>
	</footer>
	
	<script type="module" src="js/stratification.js"></script>

	<script>
		function clickTab(event) {
			changeTab(event.srcElement.getAttribute('data-pane'));
		}

		function changeTab(id) {
			
			// Set all tabs to inactive.
			let tabs = document.querySelectorAll('nav div.tab');
			for (let j = 0; j < tabs.length; j++) {
				tabs[j].classList.remove('active');
			}

			// Set clicked tab to active.
			document.querySelector(`.tab[data-pane="${id}"]`)
					.classList.add('active');

			// Hide all panes.
			let panes = document.querySelectorAll('div.pane');
			for (let j = 0; j < panes.length; j++) {
				panes[j].classList.add('hide');
			}

			// Show clicked pane.
			document
				.querySelector(`.pane[data-pane="${id}"]`)
				.classList.remove('hide');

			// Update progress bar.
			let progress = document.getElementById('progress'),
				width;
			switch(id) {
				case 'about':
					width = 20;
					break;
				case 'import':
					width = 40;
					break;
				case 'settings':
					width = 60;
					break;
				case 'run':
					width = 80;
					break;
				case 'export':
					width = 100;
					break;
			}
			progress.setAttribute('style', `width: ${width}%;`);

		}

		let tabs = document.querySelectorAll('nav div.tab');
		for (let i = 0; i < tabs.length; i ++) {
			tabs[i].addEventListener('click', clickTab, false);
		}	
	</script>

</body>

</html>